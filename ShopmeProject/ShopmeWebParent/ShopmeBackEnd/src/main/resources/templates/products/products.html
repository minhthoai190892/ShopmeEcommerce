<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity6">

</html>

<head th:replace="fragments::page_head('Manage Products','none')"></head>

<body>
    <div class="container-fluid">
        <main>
            <!-- menu -->
            <div th:replace="navigation::menu"></div>
            <!-- title -->
            <th:block sec:authorize="hasAnyAuthority('Admin','Editor')">
                <div th:replace="fragments::download_file('Manage Products','/products/')"></div>
            </th:block>
            <!-- form search-->
            <section>
                <!--th:action="@{/users/page/1}"  -->
                <form th:action="@{/products/page/1}" class="form-inline" id="searchForm">
                    <input type="hidden" name="sortField" th:value="${sortField}">
                    <input type="hidden" name="sortDir" th:value="${sortDir}">
                    Category:
                    <select name="categoryId" class="my-3" id="dropdownCategory">
                        <option value="0">All Category</option>
                        <th:block th:each="cat : ${listCategories}">
                            <option th:value="${cat.id}" th:selected="(${categoryId}==${cat.id})">[[${cat.name}]]
                            </option>
                        </th:block>
                    </select>
                    Filter:
                    <input type="search" name="keyword" th:value="${keyword}" class="my-3" required />
                    <button type="submit" value="Search" class="btn btn-primary">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </button>
                    <button type="button" value="Clear" class="btn btn-secondary" onclick="clearFilter()">
                        <i class="fa-solid fa-eraser"></i>
                    </button>
                </form>
            </section>
            <div th:if="${message!=null}" class="alert alert-success text-center">
                [[${message}]]
            </div>

            <table class="table table-striped table-inverse table-responsive">
                <thead class="thead-inverse">
                    <tr>
                        <th th:replace="fragments::column_link('id','ID','none')"></th>

                        <th>Main Image</th>
                        <th th:replace="fragments::column_link('name','Product Name','none')"></th>
                        <th th:replace="fragments::column_link('brand','Brand','none')"></th>
                        <th th:replace="fragments::column_link('category','Category','none')"></th>
                        <th:block sec:authorize="hasAnyAuthority('Admin','Editor')">
                            <th>Enabled</th>
                        </th:block>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each=" product: ${listProducts}">
                        <td scope="row">[[${product.id}]]</td>
                        <td>
                            <img th:src="@{${product.mainImagePath}}" class="img-fluid" style="width: 120px;" alt="">
                        </td>
                        <td>
                            <a class="link-detail" th:href="@{'/products/detail/'+${product.id}}"
                                th:title="${product.name}"> [[${product.shortName}]]</a>
                        </td>
                        <td>[[${product.brand.name}]]</td>
                        <td>[[${product.category.name}]]</td>
                        <th:block sec:authorize="hasAnyAuthority('Admin','Editor')">
                            <td th:replace="fragments::status(${product.enabled},'/products/'+${product.id},product)">
                            </td>
                        </th:block>
                        <td>
                            <a class="fas fa-file-alt fa-2xl icon-green link-detail"
                                th:href="@{'/products/detail/'+${product.id}}" title="View details of the product"></a>
                            <th:block sec:authorize="hasAnyAuthority('Admin','Editor','Selesperson')">|
                                <span th:replace="fragments::edit('product','/products/edit/'+${product.id})"></span>
                            </th:block>
                            <th:block sec:authorize="hasAnyAuthority('Admin','Editor')">
                                |
                                <span
                                    th:replace="fragments::delete('product','/products/delete/'+${product.id},${product.id},true)"></span>
                            </th:block>
                        </td>
                    </tr>

                </tbody>
            </table>
            <div th:replace="fragments::pagination('product')"></div>

            <!-- Modal -->
            <div th:replace="./fragments/fragment_modal::confirm_modal"></div>
            <!-- Modal -->
            <div class="modal fade modal-xl" id="detailModal" tabindex="-1" aria-labelledby="modalTitle"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        
                    </div>
                </div>
            </div>
        </main>
    </div>
    <div th:replace="fragments::footer"></div>
    <!-- Bootstrap JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous">
        </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.min.js"
        integrity="sha384-7VPbUDkoPSGFnVtYi0QogXtr74QeVeeIs99Qfg5YCF+TidwNdjvaKZX19NZ/e6oz" crossorigin="anonymous">
        </script>
    <script src=https://code.jquery.com/jquery-3.6.0.min.js></script>
    <script type="text/javaScript" th:src="@{/js/common.js}"></script>
    <script type="text/javaScript">
            moduleURL = "[[@{/products}]]";
            $(document).ready(function(){
                // lấy class link và thêm sự kiện click
                $(".link-delete").on("click",function(e){
                    e.preventDefault();
                    showDeleteConfirmModal($(this),'product')
                });
                  // lấy class link và thêm sự kiện click
                $(".link-detail").on("click",function(e){
                    e.preventDefault();
                    // lấy thông tin URL của class
                    linkDetailURL = $(this).attr("href");
                    console.log(linkDetailURL);
                    //gọi id của modal và hiển thị modal
                    $("#detailModal").modal("show").find(".modal-content").load(linkDetailURL);
                });

                //  dropdownCategory
                $("#dropdownCategory").on("change",function(){
                    $("#searchForm").submit();
                });
            });
     
         </script>
</body>

</html>